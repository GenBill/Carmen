# Carmen 股票监控系统

一个智能的美股实时监控系统，具有双模式运行、自动报警和可视化显示功能。

## 🌟 核心特性

### ✅ 智能双模式
- **盘中模式**: 监控自选股，2分钟轮询，5分钟缓存
- **盘前/盘后模式**: 扫描全nasdaq，长缓存至开盘

### ✅ 自动报警系统
- Carmen指标达到3分自动触发
- 记录到每日关注清单（JSON文件）
- 买入/卖出信号自动分类

### ✅ 可视化显示
- 🔴 红涨绿跌价格显示
- 📊 成交量比率颜色编码
- 📈 RSI趋势箭头指示
- 📉 MACD指标多色显示

### ✅ 高性能缓存
- 双层缓存（内存+文件）
- 程序重启数据仍在
- API调用节省>90%

## 🚀 快速开始

### 安装依赖
```bash
pip install -r ../requirements.txt
```

### 运行程序
```bash
cd indicator
python main.py
```

### 配置自选股
编辑 `my_stock_symbols.txt`:
```
AAPL
TSLA
NVDA
...
```

## 📊 显示示例

```
========================================================================================================================
🟢 美股盘中 | 盘中模式 | 2025-09-30 10:30:00 EDT
查询 7 只股票 | RSI8 | MACD(8,17,9) | 缓存5分钟
========================================================================================================================
股票   |     价格    涨幅     |      量比    | RSI8(前->今)           | MACD指标                                   | 信号
========================================================================================================================
AAPL   | $ 180.50  +2.50% |  🔴 125.0% |  35.2 ↑ 38.1 | DIF: 🔴 1.25 DEA: 🔴 0.85 斜率:+0.15 [买入信号]
TSLA   | $ 245.30  -1.20% |  🟢  75.0% |  68.5 ↓ 65.2 | DIF: 🟢-0.85 DEA: 🟢-0.45 斜率:-0.12
...
========================================================================================================================

🔔 本次扫描发现 1 个新信号！

📋 今日关注清单: 1 买入信号 | 0 卖出信号
  🟢 买入: AAPL
```

## ⚙️ 参数配置

### 技术指标
```python
RSI_PERIOD = 8          # RSI周期
MACD_FAST = 8           # MACD快线
MACD_SLOW = 17          # MACD慢线
MACD_SIGNAL = 9         # MACD信号线
AVG_VOLUME_DAYS = 8     # 平均成交量天数
```

### 运行参数
```python
POLL_INTERVAL = 120     # 轮询间隔(秒)
USE_CACHE = True        # 启用缓存
CACHE_MINUTES = 5       # 缓存时长(分钟)
```

## 📁 文件说明

| 文件 | 说明 |
|------|------|
| `main.py` | 主程序（双模式运行） |
| `get_stock_price.py` | 数据获取和技术指标计算 |
| `indicators.py` | Carmen综合指标 |
| `market_hours.py` | 市场时间判断 |
| `alert_system.py` | 报警系统 |
| `display_utils.py` | 可视化显示 |
| `daily_watchlist.json` | 关注清单（自动生成） |
| `.cache/` | 数据缓存目录 |

## 📚 文档

- [最终功能说明.md](./最终功能说明.md) - 详细功能说明
- [优化说明.md](./优化说明.md) - 性能优化详情
- [缓存使用说明.md](./缓存使用说明.md) - 缓存机制说明

## 🎯 工作流程

### 1. 盘前时段（自动）
```
扫描全nasdaq → 发现机会 → 添加到关注清单
```

### 2. 盘中时段（自动）
```
监控自选股 → 实时信号 → 报警通知
```

### 3. 盘后时段（自动）
```
复盘分析 → 总结信号 → 准备次日
```

## 📈 性能指标

| 指标 | 优化前 | 优化后 |
|------|--------|--------|
| 历史数据 | 34天 | 250天 |
| MACD精度 | ±0.2 | ±0.01 |
| API调用 | 100% | <10% |
| 响应速度 | - | 100倍+ |

## ⚠️ 注意事项

1. **首次运行**: 盘前扫描全nasdaq需10-30分钟
2. **终端支持**: 需支持ANSI颜色（PowerShell/WSL）
3. **API限制**: 已优化，安全余量96%+
4. **缓存管理**: 自动清理，无需手动维护

## 🤝 Carmen指标说明

综合评分系统（满分3分）：

### 买入信号（score[0] >= 3）
- ✅ 成交量爆量 (≥160%)
- ✅ RSI超卖 (≤35) 或反转上涨
- ✅ MACD金叉

### 卖出信号（score[1] >= 3）
- ✅ 成交量缩量 (≤80%)
- ✅ RSI超买 (≥65) 或反转下跌
- ✅ MACD死叉

## 📞 支持

如有问题，请查看文档或提交Issue。

---

**祝您交易顺利！📈**
